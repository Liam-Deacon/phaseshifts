<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>phaseshifts.model &mdash; phaseshifts 0.1.4-dev documentation</title>
    
    <link rel="stylesheet" href="../../_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '0.1.4-dev',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="top" title="phaseshifts 0.1.4-dev documentation" href="../../index.html" />
    <link rel="up" title="Module code" href="../index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="../../np-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../index.html">phaseshifts 0.1.4-dev documentation</a> &raquo;</li>
          <li><a href="../index.html" accesskey="U">Module code</a> &raquo;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <h1>Source code for phaseshifts.model</h1><div class="highlight"><pre>
<span class="c">#!/usr/bin/env python</span>
<span class="c">#encoding: utf-8</span>

<span class="c">##############################################################################</span>
<span class="c"># Author: Liam Deacon                                                        #</span>
<span class="c">#                                                                            #</span>
<span class="c"># Contact: liam.deacon@diamond.ac.uk                                         #</span>
<span class="c">#                                                                            #</span>
<span class="c"># Copyright: Copyright (C) 2013-2014 Liam Deacon                             #</span>
<span class="c">#                                                                            #</span>
<span class="c"># License: MIT License                                                       #</span>
<span class="c">#                                                                            #</span>
<span class="c"># Permission is hereby granted, free of charge, to any person obtaining a    #</span>
<span class="c"># copy of this software and associated documentation files (the &quot;Software&quot;), #</span>
<span class="c"># to deal in the Software without restriction, including without limitation  #</span>
<span class="c"># the rights to use, copy, modify, merge, publish, distribute, sublicense,   #</span>
<span class="c"># and/or sell copies of the Software, and to permit persons to whom the      #</span>
<span class="c"># Software is furnished to do so, subject to the following conditions:       #</span>
<span class="c">#                                                                            #</span>
<span class="c"># The above copyright notice and this permission notice shall be included in #</span>
<span class="c"># all copies or substantial portions of the Software.                        #</span>
<span class="c">#                                                                            #</span>
<span class="c"># THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR #</span>
<span class="c"># IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,   #</span>
<span class="c"># FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL    #</span>
<span class="c"># THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER #</span>
<span class="c"># LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING    #</span>
<span class="c"># FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER        #</span>
<span class="c"># DEALINGS IN THE SOFTWARE.                                                  #</span>
<span class="c">#                                                                            #</span>
<span class="c">##############################################################################</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">**model.py**</span>

<span class="sd">Provides convenience functions for generating input and calculating </span>
<span class="sd">atomic charge densities for use with the Barbieri/Van Hove phase </span>
<span class="sd">shift calculation package.</span>
<span class="sd">   </span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">print_function</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">division</span>

<span class="kn">import</span> <span class="nn">elements</span>
<span class="kn">import</span> <span class="nn">atorb</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">copy</span> <span class="kn">import</span> <span class="n">deepcopy</span>
<span class="kn">from</span> <span class="nn">shutil</span> <span class="kn">import</span> <span class="n">move</span>
<span class="kn">from</span> <span class="nn">glob</span> <span class="kn">import</span> <span class="n">glob</span>

<span class="kn">from</span> <span class="nn">lib</span> <span class="kn">import</span> <span class="n">libphsh</span> 


<div class="viewcode-block" id="Atom"><a class="viewcode-back" href="../../modules.html#phaseshifts.model.Atom">[docs]</a><span class="k">class</span> <span class="nc">Atom</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Atom class for input into cluster model for muffin-tin potential</span>
<span class="sd">    calculations.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">element</span><span class="p">,</span> <span class="n">coordinates</span><span class="o">=</span><span class="p">[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">],</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Constructor for Atom class.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        </span>
<span class="sd">        element : str or int</span>
<span class="sd">            This is either the elemental symbol, name or atomic number.</span>
<span class="sd">        coordinates : list[float, float, float] or ndarray</span>
<span class="sd">            The fractional coordinates within the unitcell in terms of the</span>
<span class="sd">            basis vector a.</span>
<span class="sd">        tag : str, optional</span>
<span class="sd">            Add a name tag to this element (useful if dealing with multiple</span>
<span class="sd">            atoms of the same element in a given model). Default is the</span>
<span class="sd">            symbol for that element - numeric ids may be appended in the model</span>
<span class="sd">            class.</span>
<span class="sd">        radius : float, optional</span>
<span class="sd">            The muffin-tin radius of the atom in Angstroms (default is to </span>
<span class="sd">            lookup &#39;atmrad&#39; in the element dictionary).</span>
<span class="sd">        valence : int, optional</span>
<span class="sd">            The valency of the atom (default is to assume neutral atom).</span>
<span class="sd">        occupancy : float, optional</span>
<span class="sd">            The fractional occupancy of the atom in the given site.</span>
<span class="sd">        </span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">element</span> <span class="o">=</span> <span class="n">elements</span><span class="o">.</span><span class="n">ELEMENTS</span><span class="p">[</span><span class="n">element</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">coordinates</span> <span class="o">=</span> <span class="bp">None</span>  <span class="c"># dummy</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_coordinates</span><span class="p">(</span><span class="n">coordinates</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">element</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">title</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tag</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">element</span><span class="o">.</span><span class="n">symbol</span><span class="o">.</span><span class="n">title</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Z</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">element</span><span class="o">.</span><span class="n">protons</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">radius</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">element</span><span class="o">.</span><span class="n">atmrad</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">valence</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="s">&#39;valence&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="k">if</span> <span class="s">&#39;radius&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="c"># assume covrad for non-zero valency</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">radius</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">element</span><span class="o">.</span><span class="n">covrad</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
        
    
    <span class="c"># checks whether two atoms are equal w.r.t. name, radius and valence</span>
    <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">Atom</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">name</span> <span class="ow">and</span> 
                    <span class="bp">self</span><span class="o">.</span><span class="n">radius</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">radius</span> <span class="ow">and</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">valence</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">valence</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>
    
    <span class="c"># checks whether two atoms are not equal w.r.t. name, radius and valence</span>
    <span class="k">def</span> <span class="nf">__neq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">__eq__</span><span class="p">(</span><span class="n">other</span><span class="p">))</span>
    
    <span class="c"># reprinting of Atom object</span>
    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="s">&quot;Atom(</span><span class="si">%s</span><span class="s">, tag=&#39;</span><span class="si">%s</span><span class="s">&#39;, radius=</span><span class="si">%s</span><span class="s">, &quot;</span> 
                <span class="s">&quot;valence=</span><span class="si">%s</span><span class="s">)&quot;</span><span class="p">)</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> 
                                  <span class="bp">self</span><span class="o">.</span><span class="n">radius</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">valence</span><span class="p">))</span>
    
    <span class="c"># redefine hash method for checking uniqueness of class instance </span>
    <span class="k">def</span> <span class="nf">__hash__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">hash</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__repr__</span><span class="p">())</span>
    
    <span class="c"># set coordinates of atom within unitcell in terms of a</span>
<div class="viewcode-block" id="Atom.set_coordinates"><a class="viewcode-back" href="../../modules.html#phaseshifts.model.Atom.set_coordinates">[docs]</a>    <span class="k">def</span> <span class="nf">set_coordinates</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">coordinates</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">coordinates</span> <span class="o">=</span> <span class="n">coordinates</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_coordinates</span> <span class="o">=</span> <span class="p">[</span><span class="n">r</span> <span class="o">/</span> <span class="mf">0.529</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">coordinates</span><span class="p">]</span>
        <span class="k">except</span> <span class="nb">any</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">e</span>
    
    <span class="c"># set valence of atom</span></div>
<div class="viewcode-block" id="Atom.set_valence"><a class="viewcode-back" href="../../modules.html#phaseshifts.model.Atom.set_valence">[docs]</a>    <span class="k">def</span> <span class="nf">set_valence</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">valency</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Sets the valency of the atom&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">valence</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">valency</span><span class="p">)</span>
        
    <span class="c"># set muffin-tin radius of atom </span></div>
<div class="viewcode-block" id="Atom.set_mufftin_radius"><a class="viewcode-back" href="../../modules.html#phaseshifts.model.Atom.set_mufftin_radius">[docs]</a>    <span class="k">def</span> <span class="nf">set_mufftin_radius</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">radius</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the muffin-tin radius of the atom in Angstroms.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">radius</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">radius</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_radius</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">radius</span> <span class="o">/</span> <span class="mf">0.529</span>  <span class="c"># in Bohr radii</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">pass</span>
        
</div></div>
<div class="viewcode-block" id="Unitcell"><a class="viewcode-back" href="../../modules.html#phaseshifts.model.Unitcell">[docs]</a><span class="k">class</span> <span class="nc">Unitcell</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Unitcell class        </span>
<span class="sd">    &#39;&#39;&#39;</span>
 
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">matrix_3x3</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Constructor for the Unitcell class</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        a : float</span>
<span class="sd">            The in-plane lattice vector in Angstroms</span>
<span class="sd">        c : float</span>
<span class="sd">            The out-of-plane lattice vector in Angstroms. For cubic systems this</span>
<span class="sd">            will be equal to a.</span>
<span class="sd">        matrix_3x3: ndarray</span>
<span class="sd">            A 3x3 matrix describing the x,y,z construction of a,b,c basis vectors</span>
<span class="sd">            of the unitcell. Units for x, y &amp; z should be in terms of fractional</span>
<span class="sd">            coordinates. </span>
<span class="sd">        alpha : float, optional</span>
<span class="sd">            Angle alpha in degrees.</span>
<span class="sd">        beta : float, optional</span>
<span class="sd">            Angle beta in degrees.</span>
<span class="sd">        gamma : float, optional</span>
<span class="sd">            Angle gamma in degrees.</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c"># Convert Angstrom input to Bohr radii</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_a</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_c</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
        
        <span class="c"># Set basis vectors</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_vectors</span><span class="p">(</span><span class="n">matrix_3x3</span><span class="p">)</span>
        
        <span class="c"># Set xstal system</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">alpha</span> <span class="o">=</span> <span class="mf">90.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">beta</span> <span class="o">=</span> <span class="mf">90.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gamma</span> <span class="o">=</span> <span class="mf">90.0</span>
        
        <span class="c"># Update additional information</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="c"># checks if two class instances are equal w.r.t. name, radius &amp; valence</span>
    <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">Atom</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">a</span> <span class="ow">and</span> 
                    <span class="bp">self</span><span class="o">.</span><span class="n">c</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">c</span> <span class="ow">and</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">alpha</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">alpha</span> <span class="ow">and</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">beta</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">beta</span> <span class="ow">and</span> 
                    <span class="bp">self</span><span class="o">.</span><span class="n">gamma</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">gamma</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>
    
    <span class="c"># checks if two class instances are not equal w.r.t. name, radius &amp; valence</span>
    <span class="k">def</span> <span class="nf">__neq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">__eq__</span><span class="p">(</span><span class="n">other</span><span class="p">))</span>
    
    <span class="c"># reprinting of class object</span>
    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span>
            <span class="s">&quot;Unitcell(a=</span><span class="si">%s</span><span class="s">, c=</span><span class="si">%s</span><span class="s">, alpha=</span><span class="si">%s</span><span class="s">, beta=</span><span class="si">%s</span><span class="s">, gamma=</span><span class="si">%s</span><span class="s">, basis=</span><span class="si">%s</span><span class="s">)&quot;</span><span class="p">)</span>  
            <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">alpha</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">beta</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gamma</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">basis</span><span class="p">))</span>
    
    <span class="c"># redefine hash method for checking uniqueness of class instance </span>
    <span class="k">def</span> <span class="nf">__hash__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">hash</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__repr__</span><span class="p">())</span>

    <span class="c"># set basis vectors from (3x3) matrix in fractional coordinates</span>
<div class="viewcode-block" id="Unitcell.set_vectors"><a class="viewcode-back" href="../../modules.html#phaseshifts.model.Unitcell.set_vectors">[docs]</a>    <span class="k">def</span> <span class="nf">set_vectors</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">m3x3</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">basis</span> <span class="o">=</span> <span class="n">m3x3</span>

    <span class="c"># set a lattice parameter</span></div>
<div class="viewcode-block" id="Unitcell.set_a"><a class="viewcode-back" href="../../modules.html#phaseshifts.model.Unitcell.set_a">[docs]</a>    <span class="k">def</span> <span class="nf">set_a</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Description</span>
<span class="sd">        -----------</span>
<span class="sd">        Set the magnitude of the in-plane lattice vector a in Angstroms.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        a: float</span>
<span class="sd">            The magnitude of the in-plane lattice vector in Angstroms  </span>
<span class="sd">        </span>
<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        To retrieve a in terms of Angstroms use &#39;unitcell.a&#39;, whereas the</span>
<span class="sd">        internal parameter &#39;unitcell._a&#39; converts a into Bohr radii </span>
<span class="sd">        (1 Bohr = 0.529Å), which is used for the muffin-tin potential</span>
<span class="sd">        calculations in libphsh (CAVPOT subroutine).</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">a</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_a</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">a</span> <span class="o">/</span> <span class="mf">0.529</span>  <span class="c"># (1 Bohr = 0.529Å)</span>

    <span class="c"># set c lattice parameter</span></div>
<div class="viewcode-block" id="Unitcell.set_c"><a class="viewcode-back" href="../../modules.html#phaseshifts.model.Unitcell.set_c">[docs]</a>    <span class="k">def</span> <span class="nf">set_c</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Description</span>
<span class="sd">        -----------</span>
<span class="sd">        Set the magnitude of the out-of-plane lattice vector a. </span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        c : float</span>
<span class="sd">            The magnitude of the in-plane lattice vector in Angstroms </span>
<span class="sd">        </span>
<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        To retrieve c in terms of Angstroms use &#39;unitcell.c&#39;, whereas the</span>
<span class="sd">        internal parameter &#39;unitcell._c&#39; converts c into Bohr radii </span>
<span class="sd">        (1 Bohr = 0.529Å), which is used for the muffin-tin potential</span>
<span class="sd">        calculations in libphsh (CAVPOT subroutine).</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span> <span class="o">/</span> <span class="mf">0.529</span>  <span class="c"># (1 Bohr = 0.529Å)</span>

    <span class="c"># set angle alpha in degrees </span></div>
<div class="viewcode-block" id="Unitcell.set_alpha"><a class="viewcode-back" href="../../modules.html#phaseshifts.model.Unitcell.set_alpha">[docs]</a>    <span class="k">def</span> <span class="nf">set_alpha</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">alpha</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">alpha</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">alpha</span><span class="p">)</span> <span class="o">%</span> <span class="mf">360.0</span>

    <span class="c"># set angle beta in degrees</span></div>
<div class="viewcode-block" id="Unitcell.set_beta"><a class="viewcode-back" href="../../modules.html#phaseshifts.model.Unitcell.set_beta">[docs]</a>    <span class="k">def</span> <span class="nf">set_beta</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">beta</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">beta</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">beta</span><span class="p">)</span> <span class="o">%</span> <span class="mf">360.0</span>

    <span class="c"># set angle gamma in degrees</span></div>
<div class="viewcode-block" id="Unitcell.set_gamma"><a class="viewcode-back" href="../../modules.html#phaseshifts.model.Unitcell.set_gamma">[docs]</a>    <span class="k">def</span> <span class="nf">set_gamma</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gamma</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gamma</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">gamma</span><span class="p">)</span> <span class="o">%</span> <span class="mf">360.0</span>

</div></div>
<div class="viewcode-block" id="CoordinatesError"><a class="viewcode-back" href="../../modules.html#phaseshifts.model.CoordinatesError">[docs]</a><span class="k">class</span> <span class="nc">CoordinatesError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Coordinate exception to raise and log duplicate coordinates.&#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">CoordinatesError</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;CoordinatesError: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">msg</span>
        
    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">msg</span>
    
    <span class="k">def</span> <span class="nf">__unicode__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">msg</span>

</div>
<div class="viewcode-block" id="Model"><a class="viewcode-back" href="../../modules.html#phaseshifts.model.Model">[docs]</a><span class="k">class</span> <span class="nc">Model</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Generic model class.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">unitcell</span><span class="p">,</span> <span class="n">atoms</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Constructor for Model class.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        unitcell : Unitcell</span>
<span class="sd">            An instance of the Unitcell class.</span>
<span class="sd">        atoms : list</span>
<span class="sd">            Array of Atom class instances which constitute the model. </span>
<span class="sd">            </span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">atoms</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_atoms</span><span class="p">(</span><span class="n">atoms</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_unitcell</span><span class="p">(</span><span class="n">unitcell</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="c"># checks if two models are equal </span>
    <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">Atom</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atoms</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">atoms</span> <span class="ow">and</span> 
                    <span class="bp">self</span><span class="o">.</span><span class="n">unitcell</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">unitcell</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>
    
    <span class="c"># checks if two models are not equal</span>
    <span class="k">def</span> <span class="nf">__neq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">__eq__</span><span class="p">(</span><span class="n">other</span><span class="p">))</span>
    
    <span class="c"># reprinting of Atom object</span>
    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="s">&quot;Model(atoms=</span><span class="si">%s</span><span class="s">, unitcell=</span><span class="si">%s</span><span class="s">)&quot;</span><span class="p">)</span>  
                <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atoms</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">unitcell</span><span class="p">))</span>
    
    <span class="c"># redefine hash method for checking uniqueness of class instance </span>
    <span class="k">def</span> <span class="nf">__hash__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">hash</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__repr__</span><span class="p">())</span>

    <span class="c"># estimate number of inequivalent atoms</span>
<div class="viewcode-block" id="Model._nineq_atoms"><a class="viewcode-back" href="../../modules.html#phaseshifts.model.Model._nineq_atoms">[docs]</a>    <span class="k">def</span> <span class="nf">_nineq_atoms</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Description</span>
<span class="sd">        -----------</span>
<span class="sd">        Internal method for estimating the number of inequivalent atoms</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        nineq_atoms, element_dict : tuple</span>
<span class="sd">            nineq_atoms : The estimated number of inequivalent atoms based on </span>
<span class="sd">                the valence and radius of each atom.</span>
<span class="sd">            element_dict : a dictionary of each element in the atom list where </span>
<span class="sd">                each element contains an atom dictionary of &#39;nineq_atoms&#39;, </span>
<span class="sd">                &#39;n_atoms&#39; and a complete &#39;atom_list&#39;</span>
<span class="sd">                </span>
<span class="sd">        Example</span>
<span class="sd">        -------</span>
<span class="sd">        &gt;&gt;&gt; C1 = Atom(&#39;C&#39;, [0, 0, 0])</span>
<span class="sd">        &gt;&gt;&gt; Re1 = Atom(&#39;Re&#39;, [0, 0, 0], valence=2.0)</span>
<span class="sd">        &gt;&gt;&gt; Re2 = Atom(&#39;Re&#39;, [0, 0, 0], radius=1)</span>
<span class="sd">        &gt;&gt;&gt; uc = Unitcell(1, 2, [[1, 0, 0], [0, 1, 0], [0, 0, 1]])</span>
<span class="sd">        &gt;&gt;&gt; mtz = MTZ_model(uc, atoms=[C1, Re1, Re2])</span>
<span class="sd">        &gt;&gt;&gt; print(mtz._nineq_atoms())</span>
<span class="sd">         (3, {&#39;Carbon&#39;: {&#39;n_atoms&#39;: 1, &#39;atom_list&#39;: [Atom(Carbon, tag=&#39;C&#39;,</span>
<span class="sd">         coordinates=[0, 0, 0], Z=6, radius=0.91, valence=0)], &#39;nineq_atoms&#39;: </span>
<span class="sd">         1,&#39;nineq_atoms_list&#39;: set([Atom(Carbon, tag=&#39;C&#39;, </span>
<span class="sd">         coordinates=[0, 0, 0], Z=6, radius=0.91, valence=0)])}, &#39;Rhenium&#39;: {</span>
<span class="sd">         &#39;n_atoms&#39;: 2, &#39;atom_list&#39;: [Atom(Rhenium, tag=&#39;Re&#39;, </span>
<span class="sd">         coordinates=[0, 0, 0], Z=75, radius=1.97, valence=2.0), Atom(Rhenium, </span>
<span class="sd">         tag=&#39;Re&#39;, coordinates=[0, 0, 0], Z=75, radius=1, valence=0)], </span>
<span class="sd">         &#39;nineq_atoms&#39;: 2, &#39;nineq_atoms_list&#39;: set([Atom(Rhenium, tag=&#39;Re&#39;,</span>
<span class="sd">         coordinates=[0, 0, 0], Z=75, radius=1.97, valence=2.0), </span>
<span class="sd">         Atom(Rhenium, tag=&#39;Re&#39;, coordinates=[0, 0, 0], Z=75, radius=1, </span>
<span class="sd">         valence=0)])}})</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">nineq_atoms</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">element_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">atom_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="c"># loop through atom list, testing each element for duplicates</span>
        <span class="c">#get list of elements</span>
        <span class="n">elements</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="n">atom</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">atom</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">atoms</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">elements</span><span class="p">:</span>
            <span class="n">atoms</span> <span class="o">=</span> <span class="p">[</span><span class="n">atom</span> <span class="k">for</span> <span class="n">atom</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">atoms</span> <span class="k">if</span> <span class="n">atom</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">element</span><span class="p">]</span>
            <span class="n">n_atoms</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">atoms</span><span class="p">))</span>
            <span class="n">nineq_atoms</span> <span class="o">+=</span> <span class="n">n_atoms</span>
            <span class="n">atom_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;nineq_atoms&#39;</span><span class="p">:</span> <span class="n">n_atoms</span><span class="p">,</span> <span class="s">&#39;n_atoms&#39;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">atoms</span><span class="p">),</span> 
                         <span class="s">&#39;atom_list&#39;</span><span class="p">:</span> <span class="n">atoms</span><span class="p">}</span>
            <span class="n">element_dict</span><span class="p">[</span><span class="n">element</span><span class="p">]</span> <span class="o">=</span> <span class="n">atom_dict</span> 
        <span class="k">return</span> <span class="n">nineq_atoms</span><span class="p">,</span> <span class="n">element_dict</span>
</div>
<div class="viewcode-block" id="Model.add_atom"><a class="viewcode-back" href="../../modules.html#phaseshifts.model.Model.add_atom">[docs]</a>    <span class="k">def</span> <span class="nf">add_atom</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">element</span><span class="p">,</span> <span class="n">position</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Append an Atom instance to the model</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        element : str or int</span>
<span class="sd">            Either an element name, symbol or atomic number.</span>
<span class="sd">        position : list(float) or ndarray</span>
<span class="sd">            (1x3) array of the fractional coordinates of the atom</span>
<span class="sd">            within the unit cell in terms of the lattice vector a.</span>
<span class="sd">            </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">atoms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Atom</span><span class="p">(</span><span class="n">element</span><span class="p">,</span> <span class="n">position</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="Model.check_coordinates"><a class="viewcode-back" href="../../modules.html#phaseshifts.model.Model.check_coordinates">[docs]</a>    <span class="k">def</span> <span class="nf">check_coordinates</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check for duplicate coordinates of different atoms in model.</span>
<span class="sd">        </span>
<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        CoordinateError : exception</span>
<span class="sd">          If duplicate positions found.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">positions</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">atom</span><span class="o">.</span><span class="n">coordinates</span><span class="p">)</span> <span class="k">for</span> <span class="n">atom</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">atoms</span><span class="p">]</span>
        <span class="n">info</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
        <span class="k">for</span> <span class="n">position</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">([</span><span class="n">position</span> <span class="k">for</span> <span class="n">position</span> <span class="ow">in</span> <span class="n">positions</span> 
                             <span class="k">if</span> <span class="n">positions</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">position</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">]):</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">atom</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">([</span><span class="n">atom</span> <span class="k">for</span> <span class="n">atom</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">atoms</span> 
                         <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">atom</span><span class="o">.</span><span class="n">coordinates</span><span class="p">)</span> <span class="o">==</span> <span class="n">position</span><span class="p">]):</span>
                <span class="n">info</span> <span class="o">+=</span> <span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="s">, coordinates=</span><span class="si">%s</span><span class="s">, index=</span><span class="si">%i</span><span class="se">\n</span><span class="s">&#39;</span>
                               <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">atom</span><span class="p">),</span> <span class="n">atom</span><span class="o">.</span><span class="n">coordinates</span><span class="p">,</span> <span class="n">i</span><span class="p">))</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">positions</span><span class="p">))</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atoms</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">CoordinatesError</span><span class="p">(</span>
                    <span class="s">&#39;Not every atom position in model is unique!</span><span class="se">\n</span><span class="si">%s</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">info</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Model.set_atoms"><a class="viewcode-back" href="../../modules.html#phaseshifts.model.Model.set_atoms">[docs]</a>    <span class="k">def</span> <span class="nf">set_atoms</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">atoms</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the atoms for the model.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        atoms : list(Atoms)</span>
<span class="sd">            Array of Atom instances. Entries in the list which are</span>
<span class="sd">            not of type Atom will be ignored.</span>
<span class="sd">              </span>
<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        TypeError : exception</span>
<span class="sd">          If atoms parameter is not a list.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">atoms</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">atoms</span> <span class="o">=</span> <span class="p">[</span><span class="n">atom</span> <span class="k">for</span> <span class="n">atom</span> <span class="ow">in</span> <span class="n">atoms</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">atom</span><span class="p">,</span> <span class="n">Atom</span><span class="p">)]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span>
</div>
<div class="viewcode-block" id="Model.set_unitcell"><a class="viewcode-back" href="../../modules.html#phaseshifts.model.Model.set_unitcell">[docs]</a>    <span class="k">def</span> <span class="nf">set_unitcell</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">unitcell</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the unitcell for the model</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        unitcell : Unitcell</span>
<span class="sd">            Instance of Unitcell class to set to model.</span>
<span class="sd">            </span>
<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        TypeError : exception </span>
<span class="sd">          If unitcell parameter is not a Unitcell.</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">unitcell</span><span class="p">,</span> <span class="n">Unitcell</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">unitcell</span> <span class="o">=</span> <span class="n">unitcell</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span>
    
</div></div>
<div class="viewcode-block" id="MTZ_model"><a class="viewcode-back" href="../../modules.html#phaseshifts.model.MTZ_model">[docs]</a><span class="k">class</span> <span class="nc">MTZ_model</span><span class="p">(</span><span class="n">Model</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Muffin-tin potential Model subclass for producing input file </span>
<span class="sd">    for muffin-tin calculations in the Barbieri/Van Hove phase </span>
<span class="sd">    shift calculation package.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">unitcell</span><span class="p">,</span> <span class="n">atoms</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Constructor for Model class.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        unitcell : Unitcell</span>
<span class="sd">            An instance of the Unitcell class.</span>
<span class="sd">        atoms : list</span>
<span class="sd">            Array of Atom class instances which constitute the model.</span>
<span class="sd">        nh : int, optional</span>
<span class="sd">            Parameter for estimating the muffin-tin zero (default: 10).</span>
<span class="sd">        exchange : float, optional</span>
<span class="sd">            Hartree type exchange term alpha (default: 0.7200).</span>
<span class="sd">        c : float, optional</span>
<span class="sd">            The height of the slab in Angstroms - if this is much larger </span>
<span class="sd">            than the bulk c distance then there will be a large vacuum </span>
<span class="sd">            and therefore should be used when calculating a thin slab </span>
<span class="sd">            rather than a bulk muffin-tin potential. Default is to lookup</span>
<span class="sd">            the out-of-plane basis vector bulk value.</span>
<span class="sd">        nform : int or str, optional</span>
<span class="sd">            The phase shift calculation type, which can be 0 or &#39;cav&#39; for</span>
<span class="sd">            using the cavpot subroutine, 1 or &#39;wil&#39; for using the William&#39;s</span>
<span class="sd">            method, and 2 or &#39;rel&#39; for using relativistic calculations suitable</span>
<span class="sd">            for the CLEED package.</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">atoms</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_atoms</span><span class="p">(</span><span class="n">atoms</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_unitcell</span><span class="p">(</span><span class="n">unitcell</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_exchange</span><span class="p">(</span><span class="mf">0.72</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_nh</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mtz</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>

<div class="viewcode-block" id="MTZ_model.set_nh"><a class="viewcode-back" href="../../modules.html#phaseshifts.model.MTZ_model.set_nh">[docs]</a>    <span class="k">def</span> <span class="nf">set_nh</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nh</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Sets the nh muffin-tin zero estimation parameter&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nh</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">nh</span><span class="p">)</span>  <span class="c"># check this is not float</span>
</div>
<div class="viewcode-block" id="MTZ_model.set_exchange"><a class="viewcode-back" href="../../modules.html#phaseshifts.model.MTZ_model.set_exchange">[docs]</a>    <span class="k">def</span> <span class="nf">set_exchange</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">alpha</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Sets the alpha exchange term for muffin-tin calculation&#39;&#39;&#39;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">exchange</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">alpha</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">pass</span>

    <span class="c"># set form of muffin-tin calculation: 0=cav, 1=wil, 2=rel</span></div>
<div class="viewcode-block" id="MTZ_model.set_nform"><a class="viewcode-back" href="../../modules.html#phaseshifts.model.MTZ_model.set_nform">[docs]</a>    <span class="k">def</span> <span class="nf">set_nform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nform</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Sets form of muffin-tin calculation</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        nform : int or str</span>
<span class="sd">          This governs the type of calculation, where nform can be:</span>
<span class="sd">          </span>
<span class="sd">          **1.** &quot;cav&quot; or 0 - use Cavendish method</span>
<span class="sd">          </span>
<span class="sd">          **2.** &quot;wil&quot; or 1 - use William&#39;s method</span>
<span class="sd">          </span>
<span class="sd">          **3.** &quot;rel&quot; or 2 - Relativistic calculations  </span>
<span class="sd">          </span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">nform</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">nform</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">nform</span> <span class="o">&lt;=</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">nform</span> <span class="o">=</span> <span class="n">nform</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">nform</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">nform</span> <span class="o">==</span> <span class="s">&#39;cav&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">nform</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">elif</span> <span class="n">nform</span> <span class="o">==</span> <span class="s">&#39;wil&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">nform</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="k">elif</span> <span class="n">nform</span> <span class="o">==</span> <span class="s">&#39;rel&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">nform</span> <span class="o">=</span> <span class="mi">2</span>
                <span class="k">elif</span> <span class="n">nform</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;0&#39;</span><span class="p">,</span> <span class="s">&#39;1&#39;</span><span class="p">,</span> <span class="s">&#39;2&#39;</span><span class="p">]:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">nform</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">nform</span><span class="p">)</span>
        <span class="k">except</span> <span class="nb">any</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">msg</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="MTZ_model.set_slab_c"><a class="viewcode-back" href="../../modules.html#phaseshifts.model.MTZ_model.set_slab_c">[docs]</a>    <span class="k">def</span> <span class="nf">set_slab_c</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Description</span>
<span class="sd">        -----------</span>
<span class="sd">        Set the maximum height of the slab in Angstroms - if this is </span>
<span class="sd">        much larger than the bulk c distance then there will be a large </span>
<span class="sd">        vacuum and therefore should be used when calculating a thin slab </span>
<span class="sd">        rather than a bulk muffin-tin potential.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        For Re the bulk c distance is 2.76Å, whereas a possible slab c distance</span>
<span class="sd">        could be ~10Å.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">c</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span> <span class="o">/</span> <span class="mf">0.529</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">pass</span>
</div>
<div class="viewcode-block" id="MTZ_model.load_from_file"><a class="viewcode-back" href="../../modules.html#phaseshifts.model.MTZ_model.load_from_file">[docs]</a>    <span class="k">def</span> <span class="nf">load_from_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Description</span>
<span class="sd">        -----------</span>
<span class="sd">        Load an cluster/slab input file and update the class instance variables</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        filename : str</span>
<span class="sd">            The path of the input file (e.g. cluster*.i or *slab*.i)</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        IOError : exception</span>
<span class="sd">          If the file cannot be read.</span>
<span class="sd">        TypeError : exception </span>
<span class="sd">          If a input line cannot be parsed correctly.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">filename</span> <span class="o">=</span> <span class="n">glob</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expanduser</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expandvars</span><span class="p">(</span><span class="n">filename</span><span class="p">)))[</span><span class="mi">0</span><span class="p">]</span>
        
        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">header</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
                <span class="n">a</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;#&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span> <span class="o">*</span> <span class="mf">0.529</span>
                <span class="n">a1</span> <span class="o">=</span> <span class="p">[</span><span class="n">t</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">for</span> <span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">((</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">),</span> 
                                <span class="n">f</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;#&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()[:</span><span class="mi">3</span><span class="p">])]</span>
                <span class="n">a2</span> <span class="o">=</span> <span class="p">[</span><span class="n">t</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">for</span> <span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">((</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">),</span> 
                                <span class="n">f</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;#&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()[:</span><span class="mi">3</span><span class="p">])]</span>
                <span class="n">a3</span> <span class="o">=</span> <span class="p">[</span><span class="n">t</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">for</span> <span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">((</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">),</span> 
                                <span class="n">f</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;#&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()[:</span><span class="mi">3</span><span class="p">])]</span>
                <span class="n">basis</span> <span class="o">=</span> <span class="p">[</span><span class="n">a1</span><span class="p">,</span> <span class="n">a2</span><span class="p">,</span> <span class="n">a3</span><span class="p">]</span>
                <span class="n">c</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">a3</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">*</span> <span class="mf">0.529</span>  <span class="c"># change to Angstroms from Bohr</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">set_unitcell</span><span class="p">(</span><span class="n">Unitcell</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">basis</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">nineq_atoms</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;#&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>
                
                <span class="bp">self</span><span class="o">.</span><span class="n">atoms</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">line</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;#&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">while</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">isalpha</span><span class="p">():</span>
                    <span class="n">n</span><span class="p">,</span> <span class="n">Z</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">rad</span> <span class="o">=</span> <span class="p">[</span><span class="n">t</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">for</span> <span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span>
                                       <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">),</span> 
                                       <span class="n">f</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;#&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()[:</span><span class="mi">4</span><span class="p">])]</span>
                    
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
                        <span class="n">position</span> <span class="o">=</span> <span class="p">[</span><span class="n">t</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">for</span> <span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span> <span class="ow">in</span> 
                                    <span class="nb">zip</span><span class="p">((</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">),</span>
                                       <span class="n">f</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;#&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()[:</span><span class="mi">3</span><span class="p">])]</span>
                        
                        <span class="n">atom</span> <span class="o">=</span> <span class="n">Atom</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">capitalize</span><span class="p">(),</span>
                                    <span class="n">coordinates</span><span class="o">=</span><span class="n">position</span><span class="p">,</span> 
                                    <span class="n">tag</span><span class="o">=</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">1</span><span class="p">],</span> <span class="n">valence</span><span class="o">=</span><span class="n">val</span><span class="p">,</span> 
                                    <span class="n">radius</span><span class="o">=</span><span class="n">rad</span><span class="p">,</span> <span class="n">Z</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">Z</span><span class="p">))</span>
                        
                        <span class="bp">self</span><span class="o">.</span><span class="n">atoms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">atom</span><span class="p">)</span>
                    <span class="n">line</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;#&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                
                <span class="c">#print(line)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">set_nform</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">set_exchange</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;#&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">set_nh</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;#&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span> 
                
        <span class="k">except</span> <span class="ne">IOError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s">&quot;cannot read &#39;</span><span class="si">%s</span><span class="s">&#39;&quot;</span> <span class="o">%</span> <span class="n">filename</span><span class="p">)</span>
        
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;malformatted input in &#39;</span><span class="si">%s</span><span class="s">&#39;&quot;</span> <span class="o">%</span> <span class="n">filename</span><span class="p">)</span>            
</div>
<div class="viewcode-block" id="MTZ_model.create_atorbs"><a class="viewcode-back" href="../../modules.html#phaseshifts.model.MTZ_model.create_atorbs">[docs]</a>    <span class="k">def</span> <span class="nf">create_atorbs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Description</span>
<span class="sd">        -----------</span>
<span class="sd">        Create Atorb input files for each element in model.</span>
<span class="sd">        </span>
<span class="sd">        Arguments</span>
<span class="sd">        ---------</span>
<span class="sd">        output_dir : str</span>
<span class="sd">            Path to output directory for files</span>
<span class="sd">        library_dir : str</span>
<span class="sd">            Path to library of input files. Use this if you&#39;ve previously</span>
<span class="sd">            created input files for a given element as it doesn&#39;t need to </span>
<span class="sd">            recalculate the radial charge density every time - note this </span>
<span class="sd">            is also a workaround to allow precalculated files if your machine&#39;s </span>
<span class="sd">            output is drastically different from what is expected.</span>
<span class="sd">        config : dict</span>
<span class="sd">            See help(atorb.gen_input) for list of keywords and values.</span>
<span class="sd">            </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        output_files : dict</span>
<span class="sd">            Dictionary list of atorb*.i input files for the Atorb class to</span>
<span class="sd">            calculate the charge density from.</span>
<span class="sd">            </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="c"># check output path</span>
        <span class="k">if</span> <span class="s">&#39;output_dir&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">output_dir</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;output_dir&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="s">&#39;library_dir&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="n">output_dir</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;library_dir&#39;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">output_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">)</span>
        
        <span class="n">atorb_files</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">at_files</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="c"># generate input files for atomic orbitals and charge densities</span>
        <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">atom</span><span class="o">.</span><span class="n">element</span><span class="o">.</span><span class="n">symbol</span><span class="p">)</span> <span class="k">for</span> <span class="n">atom</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">atoms</span><span class="p">]):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_dir</span><span class="p">,</span> <span class="s">&#39;Atorb&#39;</span><span class="p">)):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_dir</span><span class="p">,</span> <span class="s">&#39;Atorb&#39;</span><span class="p">))</span>
                <span class="k">except</span> <span class="ne">WindowsError</span><span class="p">:</span>
                    <span class="k">pass</span>  <span class="c"># directory already exists on Windows</span>
                
            <span class="n">atorb_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_dir</span><span class="p">,</span> <span class="s">&#39;Atorb&#39;</span><span class="p">,</span> <span class="s">&#39;atorb_</span><span class="si">%s</span><span class="s">.i&#39;</span> <span class="o">%</span> <span class="n">element</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">atorb_file</span><span class="p">):</span>  <span class="c"># create new atorb input file</span>
                <span class="n">atorb_file</span> <span class="o">=</span> <span class="n">atorb</span><span class="o">.</span><span class="n">Atorb</span><span class="o">.</span><span class="n">gen_input</span><span class="p">(</span><span class="n">element</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="n">atorb_file</span><span class="p">)</span>
            
            <span class="n">at_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_dir</span><span class="p">,</span> <span class="s">&#39;Atorb&#39;</span><span class="p">,</span> <span class="s">&#39;at_&#39;</span> <span class="o">+</span> <span class="n">element</span> <span class="o">+</span> <span class="s">&#39;.i&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">at_file</span><span class="p">):</span>
                <span class="n">at_file</span> <span class="o">=</span> <span class="n">atorb</span><span class="o">.</span><span class="n">Atorb</span><span class="o">.</span><span class="n">calculate_Q_density</span><span class="p">(</span><span class="nb">input</span><span class="o">=</span><span class="n">atorb_file</span><span class="p">,</span> 
                                            <span class="n">output_dir</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_dir</span><span class="p">,</span> <span class="s">&#39;Atorb&#39;</span><span class="p">))</span>
            
            <span class="c"># update lists</span>
            <span class="n">atorb_files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">atorb_file</span><span class="p">)</span>
            <span class="n">at_files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">at_file</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="p">{</span><span class="s">&#39;atorb_files&#39;</span><span class="p">:</span> <span class="n">atorb_files</span><span class="p">,</span> <span class="s">&#39;at_files&#39;</span><span class="p">:</span> <span class="n">at_files</span><span class="p">}</span> 
    </div>
<div class="viewcode-block" id="MTZ_model.gen_atomic"><a class="viewcode-back" href="../../modules.html#phaseshifts.model.MTZ_model.gen_atomic">[docs]</a>    <span class="k">def</span> <span class="nf">gen_atomic</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Description</span>
<span class="sd">        -----------</span>
<span class="sd">        </span>
<span class="sd">        Create atomic*.i input file for MTZ input based on model or </span>
<span class="sd">        list of files. </span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        input_dir : str</span>
<span class="sd">            Input directory where at*.i files are kept.</span>
<span class="sd">        input_files : tuple</span>
<span class="sd">            List of input files to generate atomic input file from.</span>
<span class="sd">        output_file : str</span>
<span class="sd">            The filename of the resulting atomic*.i output file, which is</span>
<span class="sd">            simply a superimposed set of the radial charge densities from</span>
<span class="sd">            the individual input files.</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        output_file : str</span>
<span class="sd">            Returns the output file path string.</span>
<span class="sd">        </span>
<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        IOError : exception </span>
<span class="sd">            If either input directory or files do not exist. </span>
<span class="sd">        </span>
<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        If &#39;input_files&#39; is not given then the default list of input files are </span>
<span class="sd">        inferred from the list of atoms in the model. </span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="c"># input</span>
        <span class="k">if</span> <span class="s">&#39;input_dir&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">input_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">glob</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expanduser</span><span class="p">(</span>
                            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expandvars</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;input_dir&#39;</span><span class="p">])))[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">input_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">input_dir</span><span class="p">):</span>
            <span class="n">input_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">input_dir</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">input_dir</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s">&quot;&#39;</span><span class="si">%s</span><span class="s">&#39; is not a valid input directory - &quot;</span>
                          <span class="s">&quot;does not exist!&quot;</span> <span class="o">%</span> <span class="n">input_dir</span><span class="p">)</span> 
            
        <span class="c"># output filename</span>
        <span class="k">if</span> <span class="s">&#39;output_file&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">output_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;output_file&#39;</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">output_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="s">&#39;atomic.i&#39;</span><span class="p">)</span>
        
        <span class="c"># get list of input</span>
        <span class="k">if</span> <span class="s">&#39;input_files&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">files</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;input_files&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>  <span class="c"># assume using atoms from model</span>
            <span class="n">files</span> <span class="o">=</span> <span class="p">[</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">input_dir</span><span class="p">,</span> <span class="s">&#39;at_&#39;</span> <span class="o">+</span> <span class="n">atom</span><span class="o">.</span><span class="n">element</span><span class="o">.</span><span class="n">symbol</span> 
                     <span class="o">+</span> <span class="s">&#39;.i&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">atom</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">atoms</span><span class="p">]</span>
        
        <span class="c"># generate atomic.i input file by appending multiple at.i files</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">output_file</span><span class="p">,</span> <span class="s">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        
            <span class="c"># loop through each atomic charge density file in list</span>
            <span class="k">for</span> <span class="n">input_file</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">input_file</span><span class="p">))</span> <span class="ow">or</span> <span class="n">input_file</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s">&quot;Radial charge density file &quot;</span> 
                                  <span class="s">&quot;&#39;</span><span class="si">%s</span><span class="s">&#39; does not exist!&quot;</span> <span class="o">%</span> <span class="n">input_file</span><span class="p">)</span>
                
                <span class="c"># append next input file to output</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">input_file</span><span class="p">)</span> <span class="k">as</span> <span class="n">infile</span><span class="p">:</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">infile</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
                    
        <span class="k">return</span> <span class="n">output_file</span>
    </div>
<div class="viewcode-block" id="MTZ_model.get_MTZ"><a class="viewcode-back" href="../../modules.html#phaseshifts.model.MTZ_model.get_MTZ">[docs]</a>    <span class="k">def</span> <span class="nf">get_MTZ</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Retrieves muffin-tin potential from file&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">mtz</span> <span class="o">=</span> <span class="nb">float</span><span class="p">([</span><span class="n">line</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>  <span class="c"># read first line</span>
        <span class="k">except</span> <span class="ne">IOError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">IOError</span>
    </div>
<div class="viewcode-block" id="MTZ_model.calculate_MTZ"><a class="viewcode-back" href="../../modules.html#phaseshifts.model.MTZ_model.calculate_MTZ">[docs]</a>    <span class="k">def</span> <span class="nf">calculate_MTZ</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mtz_string</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Description</span>
<span class="sd">        -----------</span>
<span class="sd">        Calculate the muffin-tin potential (MTZ) for a given cluster file</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        atomic_file : str</span>
<span class="sd">            The path to the atomic input file. If this is omitted the default</span>
<span class="sd">            is generate one using the MTZ_model.gen_atomic() method. </span>
<span class="sd">        cluster_file : str</span>
<span class="sd">            The path to the cluster input file which may be a bulk or slab </span>
<span class="sd">            model.</span>
<span class="sd">        slab : int or bool</span>
<span class="sd">            Determines whether the MTZ calculation is for a slab model (True).</span>
<span class="sd">            The default is a bulk calculation.</span>
<span class="sd">        output : dict</span>
<span class="sd">            Dictionary output of &#39;mtz&#39; - muffin-tin potential &amp; &#39;output_file&#39;</span>
<span class="sd">            - the path to the MTZ output file.</span>
<span class="sd">        </span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        output_files : list(str)</span>
<span class="sd">            Paths to the MTZ output file.</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="c"># check to see if cluster input exists</span>
        <span class="k">if</span> <span class="s">&#39;cluster_file&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">cluster_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">glob</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expanduser</span><span class="p">(</span>
                                            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expandvars</span><span class="p">(</span>
                                            <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;cluster_file&#39;</span><span class="p">])))[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cluster_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="s">&#39;cluster.i&#39;</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">cluster_file</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s">&quot;MTZ cluster file &#39;</span><span class="si">%s</span><span class="s">&#39; does not exist!&quot;</span> 
                          <span class="o">%</span> <span class="n">cluster_file</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">access</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">cluster_file</span><span class="p">),</span> <span class="n">os</span><span class="o">.</span><span class="n">W_OK</span><span class="p">)</span>
            <span class="ow">and</span> <span class="s">&#39;atomic_file&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s">&quot;Do not have write access to &#39;</span><span class="si">%s</span><span class="s">&#39;&quot;</span> 
                          <span class="o">%</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">cluster_file</span><span class="p">))</span>
        
        <span class="c"># determine type of calculation - bulk or slab    </span>
        <span class="k">if</span> <span class="s">&#39;slab&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">slab</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;slab&#39;</span><span class="p">])</span>
            <span class="n">fid</span> <span class="o">=</span> <span class="s">&#39;mtz&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">slab</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="n">fid</span> <span class="o">=</span> <span class="s">&#39;bmtz&#39;</span>
            <span class="n">mtz_string</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
        
        <span class="k">if</span> <span class="s">&#39;atomic_file&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">atomic_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;atomic_file&#39;</span><span class="p">])</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">atomic_file</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s">&quot;Appended radial charge densities file &quot;</span> 
                              <span class="s">&quot;&#39;</span><span class="si">%s</span><span class="s">&#39; does not exist!&quot;</span> <span class="o">%</span> <span class="n">atomic_file</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>  <span class="c"># generate on the fly</span>
            <span class="n">input_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">cluster_file</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">create_atorbs</span><span class="p">(</span><span class="n">output_dir</span><span class="o">=</span><span class="n">input_dir</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">gen_atomic</span><span class="p">(</span><span class="n">input_dir</span><span class="o">=</span><span class="n">input_dir</span><span class="p">)</span>
            
        <span class="k">if</span> <span class="s">&#39;output_file&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">output_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;output_file&#39;</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">output_file</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s">.i&#39;</span> <span class="o">%</span> <span class="n">fid</span>
        
        <span class="k">try</span><span class="p">:</span>
            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">output_file</span><span class="p">))</span>
        <span class="k">except</span> <span class="ne">WindowsError</span><span class="p">:</span>
            <span class="k">pass</span>
        
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">output_file</span><span class="p">):</span>
            <span class="n">move</span><span class="p">(</span><span class="n">output_file</span><span class="p">,</span> <span class="n">output_file</span> <span class="o">+</span> <span class="s">&#39;.bak&#39;</span><span class="p">)</span>
        
        <span class="c"># create mufftin debug file</span>
        <span class="n">mufftin_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">output_file</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s">&#39;_mufftin.d&#39;</span>
        <span class="n">info_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">output_file</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s">&#39;_info.txt&#39;</span>
        
        <span class="c"># call cavpot routine</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mtz</span> <span class="o">=</span> <span class="n">libphsh</span><span class="o">.</span><span class="n">cavpot</span><span class="p">(</span><span class="n">mtz_string</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">slab</span><span class="p">),</span> 
                                  <span class="n">atomic_file</span><span class="p">,</span> <span class="n">cluster_file</span><span class="p">,</span> 
                                  <span class="n">mufftin_file</span><span class="p">,</span> <span class="n">output_file</span><span class="p">,</span>
                                  <span class="n">info_file</span><span class="p">)</span>

        <span class="c"># check to see if new file has been written</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">output_file</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s">&quot;Failed to write muffin-tin potential file &#39;</span><span class="si">%s</span><span class="s">&#39;&quot;</span> 
                          <span class="o">%</span> <span class="n">output_file</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">output_file</span>
        </div>
<div class="viewcode-block" id="MTZ_model.gen_input"><a class="viewcode-back" href="../../modules.html#phaseshifts.model.MTZ_model.gen_input">[docs]</a>    <span class="k">def</span> <span class="nf">gen_input</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Description</span>
<span class="sd">        -----------</span>
<span class="sd">        Generate input file for use in the Barbieri/Van Hove phase shift </span>
<span class="sd">        calculation package (phsh1 or libphsh)</span>

<span class="sd">        Arguments</span>
<span class="sd">        ---------</span>
<span class="sd">        bulk : bool</span>
<span class="sd">            If True the c value is set to the bulk value...</span>
<span class="sd">        filename : str</span>
<span class="sd">            The path of the generated file (e.g. &#39;cluster.i&#39;)</span>
<span class="sd">        header : str</span>
<span class="sd">            A file header string.</span>
<span class="sd">        bulk : bool</span>
<span class="sd">            Specify whether generated file is a bulk or slab model</span>
<span class="sd">        pos_check : bool</span>
<span class="sd">            If true, the positions of each atom will be checked and</span>
<span class="sd">            any duplicates will cause a CoordinateError to be raised.</span>
<span class="sd">        nform : int or str</span>
<span class="sd">            Choose calculation type from either:</span>
<span class="sd">              - Cavendish (0)</span>
<span class="sd">              - Williams (1)</span>
<span class="sd">              - Relativistic (2)</span>
<span class="sd">        exchange : float</span>
<span class="sd">            Hartree-Fock exchange term alpha.</span>
<span class="sd">        nh : int</span>
<span class="sd">            Term used to estimate the muffin-tin zero.</span>
<span class="sd">            </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        filename on success</span>
<span class="sd">        </span>
<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        CoordinatesError : exception  </span>
<span class="sd">          if the model atoms have duplicate coordinates and the &#39;pos_check&#39; </span>
<span class="sd">          kwarg is set to True.</span>
<span class="sd">          </span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c"># get file header - should be single line (force if not)</span>
        <span class="k">if</span> <span class="s">&#39;header&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">header</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;header&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">,</span> <span class="s">&#39; &#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\r</span><span class="s">&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">header</span> <span class="o">=</span> <span class="s">&quot;MTZ cluster input file&quot;</span>

        <span class="k">if</span> <span class="s">&#39;bulk&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;bulk&#39;</span><span class="p">]:</span>
                <span class="n">fid</span> <span class="o">=</span> <span class="s">&#39;_bulk&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">fid</span> <span class="o">=</span> <span class="s">&#39;_slab&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fid</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>

        <span class="k">if</span> <span class="s">&#39;nform&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_nform</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;nform&#39;</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nform</span> <span class="o">=</span> <span class="mi">2</span>  <span class="c"># rel </span>

        <span class="k">if</span> <span class="s">&#39;exchange&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_exchange</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;exchange&#39;</span><span class="p">])</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">exchange</span><span class="p">,</span> <span class="nb">float</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_exchange</span><span class="p">(</span><span class="mf">0.72</span><span class="p">)</span>

        <span class="k">if</span> <span class="s">&#39;nh&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_nh</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;nh&#39;</span><span class="p">])</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nh</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_nh</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>

        <span class="c"># get filename or make educated guess</span>
        <span class="k">if</span> <span class="s">&#39;filename&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;filename&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="s">&#39;cluster</span><span class="si">%s</span><span class="s">.i&#39;</span> <span class="o">%</span> <span class="n">fid</span>

        <span class="c"># determine if coordinate duplicates </span>
        <span class="k">if</span> <span class="s">&#39;pos_check&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">bool</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;pos_check&#39;</span><span class="p">]):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">check_coordinates</span><span class="p">()</span>

        <span class="c"># auto-generate file</span>
        <span class="n">a</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">unitcell</span><span class="o">.</span><span class="n">_a</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.529</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">header</span> <span class="o">+</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="s">&quot; </span><span class="si">%7.4f</span><span class="s">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">unitcell</span><span class="o">.</span><span class="n">_a</span><span class="p">)</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">33</span><span class="p">)</span> <span class="o">+</span> 
                    <span class="s">&#39;# a lattice parameter distance in Bohr radii</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="s">&quot; </span><span class="si">%7.4f</span><span class="s"> </span><span class="si">%7.4f</span><span class="s"> </span><span class="si">%7.4f</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">unitcell</span><span class="o">.</span><span class="n">basis</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="n">a</span><span class="p">,</span>
                                                <span class="bp">self</span><span class="o">.</span><span class="n">unitcell</span><span class="o">.</span><span class="n">basis</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">a</span><span class="p">,</span>
                                                <span class="bp">self</span><span class="o">.</span><span class="n">unitcell</span><span class="o">.</span><span class="n">basis</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="o">/</span> <span class="n">a</span><span class="p">)</span>
                        <span class="p">)</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">33</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;# SPA coordinates of unit cell</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="s">&quot; </span><span class="si">%7.4f</span><span class="s"> </span><span class="si">%7.4f</span><span class="s"> </span><span class="si">%7.4f</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">unitcell</span><span class="o">.</span><span class="n">basis</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="n">a</span><span class="p">,</span>
                                                <span class="bp">self</span><span class="o">.</span><span class="n">unitcell</span><span class="o">.</span><span class="n">basis</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">a</span><span class="p">,</span>
                                                <span class="bp">self</span><span class="o">.</span><span class="n">unitcell</span><span class="o">.</span><span class="n">basis</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="o">/</span> <span class="n">a</span><span class="p">)</span>
                        <span class="p">)</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">33</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="s">&quot; </span><span class="si">%7.4f</span><span class="s"> </span><span class="si">%7.4f</span><span class="s"> </span><span class="si">%7.4f</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">unitcell</span><span class="o">.</span><span class="n">basis</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="n">a</span><span class="p">,</span>
                                                <span class="bp">self</span><span class="o">.</span><span class="n">unitcell</span><span class="o">.</span><span class="n">basis</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">a</span><span class="p">,</span>
                                                <span class="bp">self</span><span class="o">.</span><span class="n">unitcell</span><span class="o">.</span><span class="n">basis</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="o">/</span> <span class="n">a</span><span class="p">)</span>
                        <span class="p">)</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">33</span><span class="p">)</span> <span class="o">+</span> 
                        <span class="s">&#39;# Notice the value </span><span class="si">%.2f</span><span class="s"> (</span><span class="si">%s</span><span class="s"> calculation)</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">unitcell</span><span class="o">.</span><span class="n">basis</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="o">/</span> <span class="n">a</span><span class="p">,</span> 
                            <span class="n">fid</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;_&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)))</span>
            
            <span class="c"># TODO: better nineq_atoms prediction</span>
            <span class="k">if</span> <span class="s">&#39;nineq_atoms&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">nineq_atoms</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;nineq_atoms&#39;</span><span class="p">])</span>
                <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
                    <span class="n">nineq_atoms</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nineq_atoms</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">nineq_atoms</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_nineq_atoms</span><span class="p">()</span>
                
            <span class="n">tags</span> <span class="o">=</span> <span class="p">[]</span>
            
            <span class="c"># check to see if nineq_atoms is estimated in code</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">nineq_atoms</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%4i</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">nineq_atoms</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">33</span><span class="p">)</span> 
                    <span class="o">+</span> <span class="s">&#39;# number of ineq. atoms in this file (NINEQ)</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
                
                <span class="c"># now loop through each inequivalent atom and add to file</span>
                <span class="n">elements_dict</span> <span class="o">=</span> <span class="n">nineq_atoms</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">elements_dict</span><span class="p">:</span>
                    <span class="n">atoms</span> <span class="o">=</span> <span class="n">elements_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">element</span><span class="p">)[</span><span class="s">&#39;atom_list&#39;</span><span class="p">]</span>
                    
                    <span class="c"># Loop through each inequivalent atom type</span>
                    <span class="k">for</span> <span class="n">ineq_atom</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="n">atoms</span><span class="p">):</span>
                        
                        <span class="c"># get list of atoms of this type </span>
                        <span class="c"># i.e. same element, radius &amp; valence</span>
                        <span class="n">ineq_atoms</span> <span class="o">=</span> <span class="p">[</span><span class="n">atom</span> <span class="k">for</span> <span class="n">atom</span> <span class="ow">in</span> <span class="n">atoms</span> 
                                      <span class="k">if</span> <span class="n">atom</span> <span class="o">==</span> <span class="n">ineq_atom</span><span class="p">]</span>
                        <span class="n">ineq_tags</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="n">atom</span><span class="o">.</span><span class="n">tag</span> <span class="k">for</span> <span class="n">atom</span> <span class="ow">in</span> <span class="n">ineq_atoms</span> 
                                         <span class="k">if</span> <span class="n">atom</span><span class="o">.</span><span class="n">tag</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">tags</span><span class="p">])</span>

                        <span class="c"># select first unused tag from list</span>
                        <span class="k">for</span> <span class="n">tag</span> <span class="ow">in</span> <span class="n">ineq_tags</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">tag</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">tags</span><span class="p">:</span>
                                <span class="n">ineq_atom</span><span class="o">.</span><span class="n">tag</span> <span class="o">=</span> <span class="n">tag</span>
                                <span class="k">break</span>
                            
                        <span class="c"># avoid duplicate tags for different atoms</span>
                        <span class="k">while</span> <span class="n">ineq_atom</span><span class="o">.</span><span class="n">tag</span> <span class="ow">in</span> <span class="n">tags</span><span class="p">:</span>
                            <span class="n">number</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">ch</span> <span class="k">for</span> <span class="n">ch</span> <span class="ow">in</span> <span class="n">atom</span><span class="o">.</span><span class="n">tag</span> 
                                              <span class="k">if</span> <span class="n">ch</span><span class="o">.</span><span class="n">isdigit</span><span class="p">()])</span>
                            <span class="k">try</span><span class="p">:</span>
                                <span class="n">number</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">number</span><span class="p">)</span>
                                <span class="n">number</span> <span class="o">+=</span> <span class="mi">1</span>
                            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                                <span class="n">number</span> <span class="o">=</span> <span class="mi">1</span>
                            <span class="n">ineq_atom</span><span class="o">.</span><span class="n">tag</span> <span class="o">=</span> <span class="p">(</span><span class="s">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">ch</span> <span class="k">for</span> <span class="n">ch</span> <span class="ow">in</span> 
                                            <span class="n">ineq_atom</span><span class="o">.</span><span class="n">tag</span> <span class="k">if</span> <span class="n">ch</span><span class="o">.</span><span class="n">isalpha</span><span class="p">()</span> 
                                            <span class="ow">or</span> <span class="n">ch</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;_&#39;</span><span class="p">,</span> <span class="s">&#39;-&#39;</span><span class="p">,</span> <span class="s">&#39;+&#39;</span><span class="p">]]</span>
                                            <span class="p">)</span> <span class="o">+</span> <span class="s">&#39;_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">number</span><span class="p">))</span>

                        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;{0} {1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                                <span class="n">ineq_atom</span><span class="o">.</span><span class="n">element</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">capitalize</span><span class="p">(),</span>
                                <span class="n">ineq_atom</span><span class="o">.</span><span class="n">tag</span><span class="p">)</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">33</span><span class="p">)</span> <span class="o">+</span> 
                                <span class="s">&#39;# element, name tag</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
                        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%4i</span><span class="s"> </span><span class="si">%7.4f</span><span class="s"> </span><span class="si">%7.4f</span><span class="s"> </span><span class="si">%7.4f</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ineq_atoms</span><span class="p">),</span> 
                                    <span class="n">ineq_atom</span><span class="o">.</span><span class="n">Z</span><span class="p">,</span> <span class="n">ineq_atom</span><span class="o">.</span><span class="n">valence</span><span class="p">,</span> 
                                    <span class="n">ineq_atom</span><span class="o">.</span><span class="n">radius</span> <span class="o">/</span> <span class="mf">0.529</span><span class="p">)</span>
                                    <span class="p">)</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">33</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;# atoms in unit cell, &#39;</span>
                                <span class="s">&#39;Z, valence, Muffin-tin radius (Bohr radii)</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>

                        <span class="c"># write each inequivalent atom list to file</span>
                        <span class="k">for</span> <span class="n">atom</span> <span class="ow">in</span> <span class="n">ineq_atoms</span><span class="p">:</span>
                            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="s">&quot; </span><span class="si">%7.4f</span><span class="s"> </span><span class="si">%7.4f</span><span class="s"> </span><span class="si">%7.4f</span><span class="s">&quot;</span> 
                                        <span class="o">%</span> <span class="p">(</span><span class="n">atom</span><span class="o">.</span><span class="n">coordinates</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="n">a</span><span class="p">,</span>
                                           <span class="n">atom</span><span class="o">.</span><span class="n">coordinates</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">a</span><span class="p">,</span>
                                           <span class="n">atom</span><span class="o">.</span><span class="n">coordinates</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">/</span> <span class="n">a</span><span class="p">)</span>
                                        <span class="p">)</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">33</span><span class="p">)</span> <span class="o">+</span> 
                                    <span class="s">&#39;# coordinates in SPA units</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
                        
            <span class="k">else</span><span class="p">:</span>  <span class="c"># assume each element is an inequivalent atom</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%4i</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">nineq_atoms</span><span class="p">)</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">33</span><span class="p">)</span> 
                    <span class="o">+</span> <span class="s">&#39;# number of ineq. atoms in this file (NINEQ)</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
                
                <span class="k">for</span> <span class="n">atom</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">atoms</span><span class="p">:</span>
                    <span class="k">while</span> <span class="n">atom</span><span class="o">.</span><span class="n">tag</span> <span class="ow">in</span> <span class="n">tags</span><span class="p">:</span>
                        <span class="n">number</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">ch</span> <span class="k">for</span> <span class="n">ch</span> <span class="ow">in</span> <span class="n">atom</span><span class="o">.</span><span class="n">tag</span> 
                                          <span class="k">if</span> <span class="n">ch</span><span class="o">.</span><span class="n">isdigit</span><span class="p">()])</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="n">number</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">number</span><span class="p">)</span>
                            <span class="n">number</span> <span class="o">+=</span> <span class="mi">1</span>
                        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                            <span class="n">number</span> <span class="o">=</span> <span class="mi">1</span>
                        <span class="n">atom</span><span class="o">.</span><span class="n">tag</span> <span class="o">=</span> <span class="p">(</span><span class="s">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">ch</span> <span class="k">for</span> <span class="n">ch</span> <span class="ow">in</span> <span class="n">atom</span><span class="o">.</span><span class="n">tag</span> 
                                    <span class="k">if</span> <span class="n">ch</span><span class="o">.</span><span class="n">isalpha</span><span class="p">()</span> <span class="ow">or</span> <span class="n">ch</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;_&#39;</span><span class="p">,</span> <span class="s">&#39;-&#39;</span><span class="p">,</span> <span class="s">&#39;+&#39;</span><span class="p">]]</span>
                                   <span class="p">)</span> <span class="o">+</span> <span class="s">&#39;_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">number</span><span class="p">))</span>
    
                    <span class="n">tags</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">atom</span><span class="o">.</span><span class="n">tag</span><span class="p">)</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;{0} {1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">atom</span><span class="o">.</span><span class="n">element</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">capitalize</span><span class="p">(),</span> 
                            <span class="n">atom</span><span class="o">.</span><span class="n">tag</span><span class="p">)</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">33</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;# element, name tag</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%4i</span><span class="s"> </span><span class="si">%7.4f</span><span class="s"> </span><span class="si">%7.4f</span><span class="s"> </span><span class="si">%7.4f</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">nineq_atoms</span><span class="p">,</span> <span class="n">atom</span><span class="o">.</span><span class="n">Z</span><span class="p">,</span>
                            <span class="n">atom</span><span class="o">.</span><span class="n">valence</span><span class="p">,</span> <span class="n">atom</span><span class="o">.</span><span class="n">radius</span> <span class="o">/</span> <span class="mf">0.529</span><span class="p">))</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">33</span><span class="p">)</span> <span class="o">+</span> 
                            <span class="s">&#39;# atoms in unit cell, Z, valence, &#39;</span>
                            <span class="s">&#39;Muffin-tin radius (Bohr radii)</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="s">&quot; </span><span class="si">%7.4f</span><span class="s"> </span><span class="si">%7.4f</span><span class="s"> </span><span class="si">%7.4f</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span>
                                                  <span class="n">atom</span><span class="o">.</span><span class="n">coordinates</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="n">a</span><span class="p">,</span> 
                                                  <span class="n">atom</span><span class="o">.</span><span class="n">coordinates</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">a</span><span class="p">,</span>
                                                  <span class="n">atom</span><span class="o">.</span><span class="n">coordinates</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">/</span> <span class="n">a</span><span class="p">)</span>
                            <span class="p">)</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">33</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;# coordinates in SPA units</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
                    
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%4i</span><span class="s">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">nform</span><span class="p">)</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">33</span><span class="p">)</span> <span class="o">+</span> 
                    <span class="s">&#39;# nform=2|1|0 (for rel, will or cav)</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="s">&quot; </span><span class="si">%7.4f</span><span class="s">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">exchange</span><span class="p">)</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">33</span><span class="p">)</span> <span class="o">+</span> 
                    <span class="s">&#39;# alpha (for Hartree type exchange term)</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%4i</span><span class="s">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">nh</span><span class="p">)</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">33</span><span class="p">)</span> <span class="o">+</span> 
                    <span class="s">&#39;# nh (for estimating muffin-tin zero)</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
            </div>
<div class="viewcode-block" id="MTZ_model.get_elements"><a class="viewcode-back" href="../../modules.html#phaseshifts.model.MTZ_model.get_elements">[docs]</a>    <span class="k">def</span> <span class="nf">get_elements</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the unique elements in model&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">set</span><span class="p">([</span><span class="n">atom</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">atom</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">atoms</span><span class="p">])</span>


<span class="c"># #==============================================================================</span>
<span class="c"># # Testing </span>
<span class="c"># #==============================================================================</span>
<span class="c"># at = Atom(&#39;C&#39;, [0, 0, 0])</span>
<span class="c"># ab = Atom(&#39;Re&#39;, [0, 0, 0], tag=&#39;Re2&#39;)</span>
<span class="c"># ac = Atom(&#39;Re&#39;, [0, 0, 0], tag=&#39;Re1&#39;)</span>
<span class="c"># uc = Unitcell(1, 2, [[1, 0, 0], [0, 1, 0], [0, 0, 1]])</span>
<span class="c">#print(uc)</span>
<span class="c">#print(set([at, ab, ac]))</span>
<span class="c">#  </span>
<span class="c"># mtz = MTZ_model(uc, atoms=[at, ab, ac])</span>
<span class="c">#mtz.load_from_file(&#39;C:\\Users\\Liam\\Dropbox\\Programming\\Python\\LEED-PyV\\phaseshifts\\test\\Re0001\\cluster_Re_bulk.i&#39;)</span>
<span class="c">#print(mtz.get_elements())</span>
<span class="c">#mtz.load_from_file(&#39;C:\\Users\\kss07698\\Desktop\\test_cluster.bak.i&#39;)</span>
<span class="c">#mtz.gen_input(filename=&#39;C:\\Users\\kss07698\\Desktop\\test_cluster.bak.i&#39;)</span></div></div>
</pre></div>

          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="../../np-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../index.html">phaseshifts 0.1.4-dev documentation</a> &raquo;</li>
          <li><a href="../index.html" >Module code</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2013-2014, Liam Deacon.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.
    </div>
  </body>
</html>